{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"","resources":{"client_attrs":{"cedfa62e-24db-56ac-957c-58024017c423":{"y":168.8517303467,"x":227.3359680176},"9e899b98-7602-d978-305f-0e2e188d100e":{"y":123.7478290672,"x":472.5606832724},"17cddb88_deployment":{"y":169.1017367462,"x":325.7656649891}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b2ef5a3b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ce6e0be_runbook","main_task_local_reference":{"kind":"app_task","name":"b2ef5a3b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9838535a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1119cf83_runbook","main_task_local_reference":{"kind":"app_task","name":"9838535a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"b7e78e52_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3c565942_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"257d0171_runbook","main_task_local_reference":{"kind":"app_task","name":"b7e78e52_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"e21927cf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ab3e313c_runbook","main_task_local_reference":{"kind":"app_task","name":"e21927cf_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"b5853d8d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3c565942_runbook","main_task_local_reference":{"kind":"app_task","name":"b5853d8d_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"device_type":true,"disk_address":{"adapter_type":true}},"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"WebServerAHV-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"3092b110-114a-4780-ab4a-cf62cd819278"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{superuser.username}@@\n    ssh-authorized-keys:\n      - @@{superuser.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"2066e7b6-ad49-4f49-9dd8-e859cd66c0ab","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"5669def2-75c9-1358-33d2-9068cdfd0882"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"6zBdFheLCc6iMCgULUc8OH7LqZ\/zpEcr79Nzhj8BRm9EM8YqTya31NoQZZSS+i5MIUjBFruvvZQ7r4S+5aNMhon6QcYEMRcvVYOI2ihE+DpLOR0KE9l0PSeq4P8xo34UweJD9QphswlaLB\/1B0XI2syuM4IZ4qlIT\/Wtkmizn8ePX\/TC7FKN44335fDBYJ4RgMQ7LocKHmruXegJtugnkrse+2J5By2Rs\/bIvp1nHWx5I6C1Kc+Gqt7WCkaAGcjmKb1UjQMIwF8xKxKhSGQ3epr3nbklbjmSgj3BPBMZevGqCqVFZlAOfZsdMsLIGDZs3BmlrqTgqVjN\/gKWHN3HTomDoZl+3hAlrlk+8vNuJ3PrgGOefEx3FIJtRq9UgtgnLxULqMCc2lb9KsFGCuvnU8D4GGCllaM+BK407Suhy3lmKuwLF0oLc16nz4qqFCC\/sraszAg2u9U5mxoysknO+Q2veg3Cm6bY4LxcKC0oyEiK6WLlyw\/vhz9P9Uyn0\/BJ8Y49F44pm9Fm1fz0NcJFEbGVmJZfhqkEKdnG45SK87r7XhTHGy4zMLGiiGxovLeMeeuT\/MbuNPgrwDwdIUXjFf5snC7rxk8LQCbhMiogKvwp5sZVDFRWalD\/dvI2ofAtkT5bGmVYmo1Z1WO7C67mf4pE\/Zn+NzunbsKj3Pkp\/h7QsxKSfzSXbwUPXJudp2hKIAaLJXozGkIu7FiUHTi3JJI6Etnw8aRUuAn6U6MANKGQmgWplphwLDN9f5yAaIHsveJZJUsM1cgIIo4VrPOdX06QedHPdu9fW2hKBLgnx3HPqSb2yThxcLKCo6mKDYO23Y2\/OZYq4+cgDswkIbaBH6YVtvQQxeCXa5bi8GFsAI3iXA9DwdL3Eg9UDjXPKY3rUbPa+9smPLl4np+BWzcWtDGyzSCmeOS0mJJfBpJOWTO90EZ1eXNwkY4mDIWDSrhrnajgHPHexo5Rsnywz50WQAHLEwVMUfkjUMkO5ptNsSkMXzUZmXwvCTEjF\/BoJ3I\/E+iJk9WEpfMh358Jj8X+4Czl0NfNqwLADS9D+3nHd\/YzK0aeOPJ+FJg4nG7YI75KSYHwgKZetAxnnDBjm4dBoW9jSXPGcx1ldU3VhyisDMqxMFpTBtfAaa3jx92zDI3EiEi9VESY2mAlHN3Z8ZCnJqYuOxsJPu83KrOV8\/sMM371G3m2z8ouznQCNI+5O67ifeEeP7tPWKXKfypOvP2UT7rLbomaGRxa0e4G9kXpyY8uQbU608\/+vuQF\/rbybTjUBOm4ME6klze+8Hi0QuNFJ+PjbQ\/gwGsLN26Qgsslc\/+mSLgLdzIMBEfozozIq4WOn01VjwGY5abu7dMGnhhnkuVGc\/WHqsgPKcNtrf1nvZ75DlXW4eFEoPgDobFe9kz8Cybq\/9N8Z\/+e4O\/fn9G7s2NE59+GrdIPr6h3up4w1JpUBcr\/mifb9\/rNMjN5I2obCuJr6ucBc2+7niclEQctZNBF57BK8JE3L3aAHPZKt3jyK6A2FfFRZM3utgOdWwGKCyZf8Kq9b8U6pfPtQ3yK2jlUmpD3m+d00cqdfPAyA6m3aLCccDgE7XW0EU\/rESMTXsr2aZbRyck8v6J\/VFoVJy5XZc\/d\/CNUiskwAhUiXcWAozBSuQNm7B9z\/vaO591f0\/7Rv9uvuLACZ2qJSRdihjJ4y05S0QriIKo5w5M4ODingr3wzeLCoAR7jopf7FBmeYAj4C6d9SaVHGL3u5FXSlYefnk\/cQzsAqer7px4ivD0Pa737Ljr4gk\/ZtW3+nIQeT4W8Ycn74+zoqxT5Rh\/gufUAnJ8BeTRLSqgYeNRyKuUstPYqH9frbW9qlJbNDhFmU2xmEtjOOY2DRyCWuNb3j1UP9X1dBE7S6dgTkbwnBcPnibjxCpX\/PftoJplSCP4rxnK3KzuFpnVR1kbJKOvQ7n4Nu3OzGWevBkYIpklliy2GCxoIN2nNfA6GLRXFD3MRa7561e\/styYs\/+u8xvsdwrdlJzxNPlFEXohv3rp9EA\/xYvHZKB9+IdhQeakMpRg3HyvEH8XdGpfFDDG4I\/eZiNt3WkQ5cwnd1t6SAQ54RnM7Ei4qb8yufEIFOTXUflYigNixny4emZlw83dtZcvnlLkl9ZCkT62mwHHzSnIG7afAk7knY9TbLepVOdD9o\/VUdfbeUNFyfpxuC\/K6I4kPAzpg2D2GEVxtdl0mUc6lbQQUSSIvoP+u5W9q55vjM5cu6YLB4uzSZnhY918sz2GMWwmuI+6Iw8Euc3uIQYck2q8dHynrxl8n0BBA\/5sYbleX+NsX0JX2LwxBt1MdD8dQodRRI+2SmCumRfYUaSWeg614OeMOZFuKygD3BffOQ8x65LxgKuSCaZgO9TZiQCnL+qGwvexJG2cXEmeTY\/ts7eG9vNwAeX5OMnZG7j02cWcHVqZSWXgEBmbyoG0duPZtSsnNa5HtC2e\/A3E39DPq44xTuQedZZrwhJrbtdnJjRmsJ4lEL2Yjds9EixWFZPrSq5JxOi8nCOPUQrlcH+O3ek\/+vPh7+N7uYgB37yKIkhHQJHTj1rRR9FCLVCekhPQlb64m\/cUCVuLmxOs0dnU8o34JOYloSB1yRIbdRL5LZke13V5V8AkrvkjIArAFKDurKS96Dkp0Vjfg8jGwZlrNeoiBUdE0YDBhbXrRVd1gtEUh3wcTC+DhrlOC2Mdb\/Ay\/nehuhVA51v2ibHx3Mwdj8t87ooKaLJIUJwcrJC7IrT66y4Vsy5DRQQ4yomDUTmZGlrHE4T1\/PdyQ8pfDAjtNjbs0Gxe4ROc2\/CHhDgDQAjX5nZ6QK5BFkv0ZJG\/a9\/p7RLKsaUpCgdQFud4I4rVypwXUVMmQ8z2x1DQM++hECFpTAfspOieYAbUhAh3mxB0uTmsKS3kbarBHbjjSkXQriOVBI4zeLTITWZe9jX6gJlRbyh8DaoBMuAcmHSUTN9vbyNlEDuxapTicd+W8MYT7v8AE8vWb+avMoE+H4Sb9bzVvhFrvt5JsStihOdMQhD1uHDcp6K4BWLk6mkOPqTcSGWLBQxtH9OayQx\/kXsgdpYWlyhOAhs0uvKiKG+j3TPRAO2vieQvuR\/8r\/un\/vim\/jsXIUnLLkhY0HRo1WaZ67LcUs0R20RMaTdsjctwlsHGkAO2XetMZK8+fpwZsZkwfXqaLvVG60MLs+tBXVNp7kis3IOT7Vha6LW6e74sevAgIZvDGH+njPsNWkfWMciKM6HkNMUI2hrD0Ekx8DqphmdpibAewigwK0ajh2Csph\/sGFvjwLvqfhQVdLhIm6k1d+1\/5CfU8ph0:utf-8"},"name":"superuser"}],"package_definition_list":[{"description":"CentosOS image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"WebServer_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"2Tier_Webapp"}],"name":"33d23cd4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo touch \/var\/www\/html\/index.php\r\nsudo chown @@{superuser.username}@@:@@{superuser.username}@@ \/var\/www\/html\/index.php\r\n\r\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\r\n<html>\r\n<head>\r\n  <title>@@{calm_blueprint_name}@@<\/title>\r\n<\/head>\r\n<body>\r\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\r\n<?php\r\n\r\ntry {\r\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\r\n}\r\n\r\ncatch (PDOException $e) {\r\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\r\n  print phpinfo();\r\n  die();\r\n}\r\n?><\/body>\r\n<\/html>\r\nEOF\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"437955dc_runbook","main_task_local_reference":{"kind":"app_task","name":"33d23cd4_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"2056e4c5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69b28771_runbook","main_task_local_reference":{"kind":"app_task","name":"2056e4c5_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"17cddb88_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"WebServer_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"xyz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"superuser"},"type":"USER"},"name":"WebApplication"},"api_version":"3.0","metadata":{"last_update_time":"1612264444493823","kind":"blueprint","spec_version":19,"creation_time":"1612259445641122","name":"WebApplication"}}