{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"","resources":{"client_attrs":{"None":{"y":192.1168740568,"x":250.3655071105},"7379a377_deployment":{"y":152.4560545393,"x":11.0954119027},"e63951b3_deployment":{"y":152.1914523611,"x":498.9437204578},"17cddb88_deployment":{"y":149.7899753999,"x":265.68789722}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b2ef5a3b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ce6e0be_runbook","main_task_local_reference":{"kind":"app_task","name":"b2ef5a3b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9838535a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1119cf83_runbook","main_task_local_reference":{"kind":"app_task","name":"9838535a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"b7e78e52_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3c565942_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"257d0171_runbook","main_task_local_reference":{"kind":"app_task","name":"b7e78e52_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"e21927cf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ab3e313c_runbook","main_task_local_reference":{"kind":"app_task","name":"e21927cf_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"b5853d8d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3c565942_runbook","main_task_local_reference":{"kind":"app_task","name":"b5853d8d_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MySQL"}],"name":"small","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1d2e8848_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"af3291f6_runbook","main_task_local_reference":{"kind":"app_task","name":"1d2e8848_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34d4fb4d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"533a09ef_runbook","main_task_local_reference":{"kind":"app_task","name":"34d4fb4d_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"d8d47293_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"82af0128_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"84df2d51_runbook","main_task_local_reference":{"kind":"app_task","name":"d8d47293_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"4b299e5b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"cf744d91_runbook","main_task_local_reference":{"kind":"app_task","name":"4b299e5b_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"53bc245e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"82af0128_runbook","main_task_local_reference":{"kind":"app_task","name":"53bc245e_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"small"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7d9a8263_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d300c3a4_runbook","main_task_local_reference":{"kind":"app_task","name":"7d9a8263_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"62ca824e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9225f107_runbook","main_task_local_reference":{"kind":"app_task","name":"62ca824e_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"57180162_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3fb1bcc5_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"61bb8f38_runbook","main_task_local_reference":{"kind":"app_task","name":"57180162_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Stop"}],"name":"d092f621_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0794dfee_runbook","main_task_local_reference":{"kind":"app_task","name":"d092f621_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Restart"}],"name":"a2fd78ee_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3fb1bcc5_runbook","main_task_local_reference":{"kind":"app_task","name":"a2fd78ee_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MySQL","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"smallAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"www-@@{calm_array_index}@@-","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"558385e3-c2a1-4ccf-b17a-825254afb50d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"1b0f3f6c-da51-4fd5-8adb-eb8dcad84e3e","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"279c37ae-c8da-4e1a-8f40-53d366349f54"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAProxyAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"device_type":true,"disk_address":{"adapter_type":true}}}}}}},"os_type":"Linux","create_spec":{"name":"HAProxy-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"558385e3-c2a1-4ccf-b17a-825254afb50d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{superuser.username}@@\n    ssh-authorized-keys:\n      - @@{superuser.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"1b0f3f6c-da51-4fd5-8adb-eb8dcad84e3e","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"279c37ae-c8da-4e1a-8f40-53d366349f54"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"MySQLAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true}}}}}},"os_type":"Linux","create_spec":{"name":"MYSQL-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"558385e3-c2a1-4ccf-b17a-825254afb50d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{superuser.username}@@\n    ssh-authorized-keys:\n      - @@{superuser.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"1b0f3f6c-da51-4fd5-8adb-eb8dcad84e3e","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"279c37ae-c8da-4e1a-8f40-53d366349f54"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"teccadmin_user","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"EGw8TwbZbFlOpEcF8YidfeeG0iIqHz\/vPWCTKPjp2Y3mFOhUTFqy5kw2CPUhhL+P2c6IuMGIwAi\/alX9Nw7ereddGd2O4uB99QSbQi+Kki46En5gDDDxArOPHpg6sZiG0jnyZ0oKivIoUTxSd8G8HrSSGMN\/erCnpiLoBTyS2eGnSFamZv0IhC3pr8lQuA+QoMCNLn+wvMCX3aMQep8Cni6\/gNHkqIyLULLBBhBoScxU7PTC2FyLD8diEIlHV7xza0fP6qZlCpW7dWJCL+kPyXWaESBYnp7Eyoo7JwXQpsuZeeTtE63uxh8zvjiZYv+\/DkU6LCqgL0p9ZYDsNFtH4XjvY07VLz3Lzd88025wKomXR4\/jl\/3N2AOU0od78d9+K5myGDbH3JhpLtAM52hfr4E8ayTQWeQgUn5Uc73lwd2CFFvX4W8Y8RIuOuqB6WEzoA2n9h2UA5RNZXh9MrWpHnHsDj2LEBRS3HcImNeaskEDvBa8cB8DAM5Gt91qXHcYF\/7B5mtA5zyxm\/P8ms5yrgldOzZxcFSUxqfds+SCxQHnj2H8VIALTPPzUGPg5P7Hqo0kkWVIQVt7dzw\/WdAvKTgMUNvFpcEat92IfbEIGOgB5VcTnRvxuegpr7SqTtbOLJDax1t1se+Chxk9zBNqPqZzSVVd0t\/L4\/E2O0u4r\/kZGV02cWdTZmFCY+v9H7PuyeQ5CGbJerJHKWnHDGOTVDplg8QidcjXjfd2myL1UXDP4t5I22NNxxhHbUS1BQ89XpXZukft4196bBqu4CZZvUgoBIZHfla+IHHwzQu\/Wh3TfX0dkfAdxaWX3DjtSo6KUTZtrBhj5bamXPeQhS1LfPtvwWJFw192FHGAzW1M39GpDGEp9MyZGXL0voBWJZBpkmIFRvndXcSx4Gx3iXBpUh\/FiTGseDchZZgU1v1+lxFx6pwVp2ES+rIE+fFjl9O0YCC8pneknuksWvlG2tBtG\/bR1MDuCm3SnJX6GbNNcbytY1qybjrC5Vfy3P31QkEcgB0YkoeEl3BHvOGVlNUlTQ5ZsdgSCNSlz3\/mgcWfm\/hlE44EtA0J5Un+j3ZPzCHFwoRGQ8V+bSdzpwL5VAInWMw63HHbd9n+9rSR8FPDvCpUzm2rmoT6jZPqNZoGzYslXBGw0IXr4+6hnXKTddWaIGw8XrACHCFpvvYzpkBdTB6xuAVlW+nezW32KgDty4PpcKIo7ltRbj75qTlZudvCyLJ1Jy7VUdzmUGuqjwLDQtR\/+hPx6xxuns8rV8aNPU\/KxPregPFQ+amgzg+ue88d5bIojojkjngZnq2uErCcctS95l0IqfBlyfhcTIRVGkfBTNBQ8W0\/8DXQyM3Nt9rcRFIlWz6HbkRleR\/yPYPixpxWDaqgzXfUX6VyR5DvYthiTYgg6TcLjNgxBFKQNEeNFIhvacQzegiWchCKtOPaMV\/xSl7fUdDlfNTd562BhJ7MWBg3+dfN5\/Zn2PVbqnczadkuHsm3qHt6B8YyQI0LMLU94tFkad7FsvH2JGIQIlX6RHnpH8LtYRzFexX7U2OaGhjsE2bFN0y4\/ZdXH0ugDnWHjZTvXJuWHD8eCWdRhBVKIl6m8X5OKnREl3vonXL3H0GSehJ\/wEPuP1hywRuelxR0GIVKRiE846soaSu6qwqHQIDKKJEUHVqC7ILutJ5XBjecT+qtesy1b\/8RW+eWQjJ783xVskdGUanD+9pqqq39Ov6M\/6R3WgoZvIjuz7WGOGhDXF\/BYI+587\/UMbCTydWPMuJKvi92p4y9SkJqKYwVC6wIAO\/rtF4F1NBqH\/lg5CxLr19Gvc3sUOdQZMtQYf4ATOfJ8bdbPWsdJN8+nFLF+TKkYgNCB5Ocu3gcMSyQMQPpUE3CCaEYlq7aCUDosXhUQbAyn8Y\/QigQcrZuFloGWOXTSjhy5LOUid7WfBkCGF7DGNRz9MQf5V\/kZKQ87LOcajEjvB0+CyHlJirLigszGcLI98QxilhHJYS7AdJDvf\/QRgVDhD\/9Wc6u8W6SkmsKNg6+s5ltZj+qHznotWW3JnTdAjD1F3nP44taESjayhOyPXCjfcqLiJ1kQIz9QiCLlUEExuX4kX7vVKHrVWG3dTFRkzRUPBIqzW3gyFMmwTTsRG4vDEKj\/DglRUOk8U+4I6FQWhxB46HCCZieJj4\/knO6Uma0GvRfx+xNTskb5ZH1zTvGwfOcLpfdK7Rf1sIVm\/J0hBkARkCXM6Ohd8oqqM33HhKFR0HrnRJmjDkslWcNB847qGsWHx3gC2TNv8cgB\/L\/2WWzQP6xAeAEzURX\/csEP0cNoMZiq81qGL64WzZCltlotOskRgmjZee3T+aKVYkkPDjXjZHEmjKsaFMe8KV+nKKKjkLcU9iy8AWJRwgdhY97AxAVzpIFFv8gKIkalJrpk+RV6lIoiJGhDW75g9wl+x0aJKSMB+MeQWcy8DNtJXu9CCI0jUzvvfthvkERxEPAL3rgmDBChAgTtUsVLibJ1aY7Z5SjCo42CvxVbEvY0C93OuFGJKlj5jjWkrZH\/LCrSm69xq1JPl0CKJWmEp26jFk88kxx+He1zNsiERbzi47UV4rPDERoAGA\/EMXKBEd50nYyW6TUboT2YOf0a+V7kd\/aJqaf5x5M2k8K6i335MKAyzDxVCsfzxQE2\/jtAMusf6qnyTqaq8Zd44mTyNeJ5hMk2N\/iSExYWF0PI1hLuldYbu4qN8zcDVMNrmmOOnm+Qz3CoEsP3CZRgJ8\/xoAO2sRrXp\/wBPMckbFFybNgv84au3zGKhVni3gzlHAxyc+KC0Gr6UZYdrKy\/h\/wQWWH9YtwvgB5mdnMsfdbSJ\/h8sFTFrxdBOGXXKPuYThNx8tooXtC\/9JY80vLvtJn8aFk\/qZzkjXbAd58DYts7E\/Vpu6+w8O91UmTWoysbQ0ITkPv0AFSyt92ym\/u9bgimU7FjoJn1Hs\/VelUXnCd5d2S+mTOK8rWg4cgx+geBgs8QmTNWLJwb7Q\/RbrXmKQpa0R5\/oBlw6EnMT\/RugO5YNA0ENYlwr94KMk+y1e73IIif0KyhkoPt2mKSv8b6Eq+s8kTwpOmtEgTC2j9e4gNuUsj2PT\/rTSJvvKl5YXsA8+wJarS1M3eEjhXOnOPqhBz9pXyA3wy9I702S48yYlgDev9tPewl3wOoVSPo929QUk20uyHul7oB+13m8Yj1y5jl179f3rbFrFE2jTfkCR72D\/dU1ZQSCor9B\/AWdxTozt0Fs4oPWlCKHjb0iWlP9RK5tRS1MmMob2QTsdyx6hLcSttLYDDRx3dZjooiT6KhuZdmnQto6m3:utf-8"},"name":"teccadmin"},{"username":"teccdba_user","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"k5s2dc9r2yoJJnCVKA3uPn55FRq6+OAO246i6XRwEoVCn5B\/YdjX\/A7FDryMolK97\/LoPi3qWzauobgXskfGDLriPwx7Btv30yvX3BVBjHf+daNBFudrlkv+pC55jRDyj5+type\/4BNvqsOlWCDSIggjDKJ7o3aGU2QKzqlUz\/m0fbb0+uTHgcWh5Q4V+IXvk\/J9wugzEpr1BfAzqpbA0azRCTGWWnp8PDm4abXaeffSKptPaDvDdrFVpGgPR4sJn3E080IIaDRUo4QfEx2UH3l5n96R6J6w9LRohZf2Bx7QLJVn5y5qW+l0wlwlrNt5VRNe5t7DWyFCDSQCXrN81O9vX\/tZMN4PsM84Ml6\/P11Q4bw\/u443auhmZRjP3huc2PKLU6udZnL0QAOb9vLrpO52ChwPDCig0qPj+oGkt6sLCKVsoJLtmrzyVS1ma4mKn2Yd1OmdAXbpEd53uWLL3fg2wPMH9kPA1v6cHdq\/TM2o+uhyHkPZV8ktXv\/QyehxIUN8GCC9m6\/A55AIqybLmSuNRaM7wayp\/NZc0btqQCAGh6i6i\/vbq+ywpvNWam7HJ6XeRUS\/o7VGL1fjuG+FrIiXgkhLhJojG9er8NOcuphuc\/cXjXDhnaRnkEd6nRDugdc+u\/XaHqvnFFM3LZNAZXgG8c7nYdjSkcbAaS0NXKLpw6q1WTBxYQJ6U1IPuWeC6BJ2VWnaF9TZti\/NLiDIoSWYubYXZZrhcK23zRU18uUKk9pE3X\/CQ6B9bglmBeqrtA4Yh9Y5NDk+YKcVz0TMRqmyP9ICpT\/gAiBfcAd8VoR9AEZBLcXyViee1DezMY1xNc2XVZsfTwKl3yekpJ0D4gxQqU\/+ULFUPsx9IgvpOZFAB0LRkLrq5JhP+t7NXOi6G\/zINqVWkfv6E\/gQajorKBLk7yA6mLFRjTQkuxQX0yc1ypZDS2zvjEEC+Vvs08k2fuY5Mzs3gZ8IZgswZ6PqGIV2l+XIXH2mrN2viAFMQhQ6nk2P0Jz9Qny2L7xFcjFkX+H9sBiACBHwG8JzftEak3jfjGImM59grIxwHmpUQdSessfYgmfwZkZ0Y40mto1yumvgQlRn75uHUfTrqzcDXpR0H+1aJJWVSDZiS6f4nOwm6pnCsiz8L5+VLCVFTtWQgKkFkFjMvPkiumBNBGf5OQg74OeCFS9TZCOE5plpW6+ZE1xMNd2ZCWjdEyxOSDr60cXfMGvowcy91dHbvtHk\/vP94XyWCPc587iF\/BVUG1qcvMitDn76XcoC0EltmON786dQzdXqX1rLC22BsxDBeLaBSpPpqQDxxKCRKBo77PVhHzeKE0o\/busY1cmEAh6UwJZ31CQadBFwjLl2oyOVBBZUYE20n+dKOIfqknuvyp59SQL4CoPWsW6NZUt1azG8EgeF4Un\/T\/WQGZdfTa81rNKDcfxrN3t7JjFFMClS3tN+4c1F31sxaUwxwP98sud1JbYieVblQA8ZaA5uWzPxRlVWo6IS8OTLfq64bgN0nUH4RKcL2Zun0mzyYjYsheIOfuGuawjACD643\/aVbkLTH19sB7v8l7+9ybod+Dup6oJSDHtWMf5ZwTie70+lYtFJAMDgnKYY2gzottJliJwPuM5AtbjpK1XnH4\/T9SF1ZmovD92XjXVqs\/pcJNhSU72hpJUck8017Vbe19mY4g+CpVbPucYPF+zV7ijrzsr48cnwAA8Bk0Enq12SIOzr+KbRdHFw\/2qyYtsqaOWY\/7A1o2ni\/1yo733GgASkwhmvsVVGwHXVgd4Nyc8XenWKY22\/peZxh93HBe8Rr9enGYaU2vNI3aqfzL+humw4I\/ljSOgxD7z7ahJ+K2Xhe6FgiJ3\/npovbCiYWG8t2qWlFZuq+XhNqFf6XTbpEAiW\/rxfouHIlJeqsHqszxp1DdrclYc0bEdXmkubQUOCJywo0YX1qf5NNd+3sA71G9ClaQi6TbNruQ+eumxXdfvKmYHA2MMKbwAUO8gmJ6p4t2YOqbi\/G90e\/0xbQJT3XiZAoW0NtJ5RXRs09RChaycfp0p6Zn6W2U4chFtcw4S\/T495ZbG6yv7NdMrQsAr2Fl6PG15CON9QC\/C6CKIYOkU21K8WeY1rrUp2wARHeYR+NLnenFsw2PXn\/K7fmFm7HuwYEBC5iOK5ivu5erPDpbZlXxew9TDvWTQwFnSUbALsKwqaMuIa\/DtSvXDSyYsoIP+lSBRKV1gQWRtmGsmeK0+riA4fpqRSOGIIssI0sbB4Nspsosjlw\/tiqQSasF7QMNY4NCFYgWMtxHwmyNp5Qjvad6RwO8B\/NcoPVSgoDDJPQRZ1hjztuhvfQo+63zukLkevq+cyp9WTiXYjxiuogFiydJ31P25Wi2ymGSoPjGo1bJ08wc0bapIFG2EqaehcZpP9ErPIdtWikwgRF+sOEQTPmI8e+Gl5tpAkLxT4NNbRdBcxQ\/rs8MKg2pxNkKoW6L3YLMg\/p4b3a7VtOrfuWOnuXeFXRoFkEHKcmv07sl6HNCPedsN13QIUYnD3RT+JKZW83cnPaMTCklNF7ismdwZnuFy1DYYvSQEVFy084znONBNJgJ58D\/Vl7GNmUbo7arGpmH83u7fpRj2OLl1r1LH9CSRecG9JF+m52HqoNNYfqTMSSCPlOr5wgT0hcvuA1cm+CtC79oonIAqsyGJm+a7Gn7laS+Xtgqopa5AUjGdH+Nn5ubC2D5jlWytDsmmHky6ZVEy6z1oS6QC23+mBQcpJ6rabTnIK0\/OYwPpGEntlXxNDqQJnh19a2Nwbb0VncGFQ\/g\/osWsrueQTSo5j0f+jxwh\/MlAYOXo2Dz1f5jMsWykWrMtzWGfsSH230Zja8b\/UXh\/hBsoJOAY++XBhU2XlafzwOWmZ1HPDbIEfWCbsaV0svruROcXYfh\/nBELrLzBLmGZwpke28pMEpUyO3pJc6PLilSpc5h5kYnaZ7MGfJzyqw5fNtT\/XzXzY\/S9zu8+aDYfa+H\/3Ufur1PYq8aCzizXZa4UteXETVu4+ssVnYxJKRmQn3raMQnTCqTVpKHbEJn9gSAjy5Et6X6c6uU+h6kwqOBAnZKxQA7W0FDRgo7gcVwHI09hqafj2bx28AK06C4q4bPIzV9hQyrnTs7NhJ1byrcZ2pRHsuQle5mlUlDbhmex17rbatjtPrAXAKfnuedRabIdg0BalCXo7J9AJCqusSRXYAl+13Xq8VCYruwNmPguKg37FJ9YcKzATNSGTcdq4SYQ39FcB91fLH1r7yCo0SvOEuE5orbkzbQWdIiCZfMxL7L4ua72kQih6WAj\/cXiCPdQpHJfLD23g:utf-8"},"name":"teccdba"}],"package_definition_list":[{"description":"CentosOS image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"small"}],"name":"Small_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Small_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"3Tier_Webapp"}],"name":"33d23cd4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"3Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\nsudo touch \/var\/www\/html\/index.php\nsudo chown @@{teccadmin.username}@@:@@{teccadmin.username}@@ \/var\/www\/html\/index.php\n\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\n<html>\n<head>\n  <title>@@{calm_blueprint_name}@@<\/title>\n<\/head>\n<body>\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\n<?php\ntry {\n  $dbh = new PDO('mysql:host=@@{MySQL.address}@@;dbname=@@{DATABASE_NAME}@@', '@@{MYSQL_APP_USER}@@', '@@{MYSQL_PASSWORD}@@', array(\n    PDO::ATTR_PERSISTENT => true,\n    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n  ));\n\n  \/\/ ensure there is at least 1 row of data for the app to read\n  $data = $dbh->query(\"INSERT INTO @@{DATABASE_TABLE}@@ (id, time, message) VALUES (NULL, CURRENT_TIMESTAMP, '@@{calm_username}@@')\");\n\n  $data = $dbh->query('SELECT MAX(id) AS count FROM @@{DATABASE_TABLE}@@')->fetchAll(PDO::FETCH_COLUMN);\n  $count = $data[0]; \/\/print_r($data);\n  $data = $dbh->query(\"SELECT time, message FROM @@{DATABASE_TABLE}@@ WHERE id = $count\")->fetchAll(PDO::FETCH_ASSOC);\n  $time = $data[0]['time'];\n  $message = $data[0]['message'];\n\n  echo \"<p>Database records: $count<\/p>\\n\";\n  echo \"<p>Last maintainer: $message, on: $time<\/p>\\n\";\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\n\n  $dbh = null;\n}\ncatch (PDOException $e) {\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\n  print phpinfo();\n  die();\n}\n?><\/body>\n<\/html>\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"437955dc_runbook","main_task_local_reference":{"kind":"app_task","name":"33d23cd4_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Small_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"2056e4c5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"small"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69b28771_runbook","main_task_local_reference":{"kind":"app_task","name":"2056e4c5_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"4773a1cf_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5d667f9d_runbook","main_task_local_reference":{"kind":"app_task","name":"4773a1cf_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_HAProxy"}],"name":"978687e8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_HAProxy","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bb501356_runbook","main_task_local_reference":{"kind":"app_task","name":"978687e8_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL"}],"name":"MySQL__Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL__Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"MySQL_Install"}],"name":"f0266aea_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MySQL_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\n# Assuming CentOS\/RedHat 8.2\necho \"__ Mysql installation...\"\n# https:\/\/dev.mysql.com\/doc\/refman\/8.0\/en\/linux-installation-yum-repo.html\n\nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql80-community-release-el8.rpm\" &&\n  sudo yum module -y disable mysql &&\n  sudo yum install -y mysql-community-server\n\n# database must be started for SQL configuration\nsudo systemctl start mysqld\n# database should start on OS boot\nsudo systemctl enable mysqld\n# sudo systemctl status mysqld.service\n\necho \"__ Altering database root password...\"\n\nmysql --user=root --connect-expired-password \\\n  --password=\"$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\" <<- EOF\n\nSET GLOBAL validate_password.policy=LOW;\nALTER user 'root'@'localhost' IDENTIFIED BY '@@{MYSQL_PASSWORD}@@';\n\nFLUSH PRIVILEGES;\nEOF\n\necho \"__ Creating database, table, and app user permissions...\"\n\nmysql --user=root --password='@@{MYSQL_PASSWORD}@@' <<- \"EOF\"\n\nCREATE DATABASE IF NOT EXISTS @@{DATABASE_NAME}@@ ;\nCREATE TABLE IF NOT EXISTS @@{DATABASE_NAME}@@.@@{DATABASE_TABLE}@@ ( \\\n  id INT NOT NULL AUTO_INCREMENT , \\\n  time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP , \\\n  message VARCHAR(80) NULL DEFAULT NULL , \\\n  PRIMARY KEY (id)) \\\n  ENGINE = InnoDB CHARSET=ascii COLLATE ascii_general_ci COMMENT = 'testing';\n\nFLUSH PRIVILEGES;\nCREATE USER '@@{MYSQL_APP_USER}@@'@'%' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'%';\n\nCREATE USER '@@{MYSQL_APP_USER}@@'@'localhost' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'localhost';\n\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6b1756f4_runbook","main_task_local_reference":{"kind":"app_task","name":"f0266aea_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL__Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Uninstall"}],"name":"ae26dd5b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\necho \"Generic uninstall script, goodbye!\"\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"82c99a18_runbook","main_task_local_reference":{"kind":"app_task","name":"ae26dd5b_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"17cddb88_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"Small_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"smallAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"7379a377_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"e63951b3_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MySQL__Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"MySQLAHV"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"},{"kind":"app_task","name":"HAProxy_Update"},{"kind":"app_task","name":"Restart"}],"name":"7633ba2c_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"ScaleOut"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Update"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"17cddb88_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"82af0128_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"a093b86b_runbook","main_task_local_reference":{"kind":"app_task","name":"7633ba2c_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleIn"},{"kind":"app_task","name":"HAProxy_Update"},{"kind":"app_task","name":"Restart"}],"name":"06547e7d_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"ScaleIn"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Update"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"17cddb88_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Update","attrs":{"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"82af0128_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"8d458e50_runbook","main_task_local_reference":{"kind":"app_task","name":"06547e7d_dag"},"variable_list":[]},"name":"WebScaleIn"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"xyz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webuser","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"MySQL low password security are 8 or more characters with at least 1 uppercaso char","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"2LLJR7JV5QyKspDO67oB1mvHwEQlz2D6iNR6URE90OQAM+GTSublrxfw:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"webapp","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"visitors","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"teccadmin"},"type":"USER"},"name":"Three-Tier_Web_Application"},"api_version":"3.0","metadata":{"last_update_time":"1612594007597136","kind":"blueprint","spec_version":9,"creation_time":"1612589521918747","name":"Three-Tier_Web_Application"}}